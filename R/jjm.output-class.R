
.getJjmOutput = function(path, output, input, model, ...) {
  
  # paths
  inputPath   = path
  ctl = paste0(model, ".ctl")
  dat = .getDatFile(ctl, input=NULL) # path to dat file
  yld = file.path(output, paste0(model, ".yld")) # add path
  par = paste0(inputPath, "/arc/", model, ".par")
  # basic info
  modelName = .getModelName(ctl)
  version = .versionJJM(ctl)
  
  files = list.files(path = output, pattern = paste0(model, ".*_R.rep"))
  files = file.path(output, Files)
  
  data  = .readDat(filename = file.path(inputPath, dat), version=version)
  control = .readCtl(filename=ctl, info, version=version)
  parameters = .readPar(filename=par, control=control, info=info, version=version)
  
  # Read files .rep and .yld
  outputs = .readOutputsJJM(files=files, yld=yld)
  info = .getInfo(data=data, output=outputs, version=version, model=modelName)
  
  # Group in a list
  output = list()  											
  output[[modelName]] = list(info = info, data = data, control = control, 
                             parameters = parameters, output = outputs)
				  
  class(output) = c("jjm.output")
  return(output)
}

print.jjm.output = function(x, ...) {
  
  for(i in seq_along(x)){
  
  obj = x[[i]]
  
  cat("JJM version: ", obj$info$data$version, "\n")
  cat("Model name: ", obj$info$output$model, "\n")
  cat("Stock number: ", paste(obj$info$output$nStock, collapse = ", "), "\n")
  
  if(obj$info$data$version == "2015MS"){
  stockNames = strsplit(obj$control$nameStock, "%")[[1]]
  cat("Stock names: ", paste(stockNames, collapse = ", "), "\n")
  }
  
  cat("Number of variables: ", obj$info$data$variables, "\n", sep = "")
  cat("Years from: ", obj$info$data$year[1] ,"to", obj$info$data$year[2], "\n", sep = " ")
  cat("Ages from: ", obj$info$data$age[1] ,"to", obj$info$data$age[2], "\n", sep = " ")
  cat("Lengths from: ", obj$info$data$length[1] ,"to", obj$info$data$length[2], "\n", sep = " ")
  cat("Fisheries names: ", paste(obj$info$output$fisheryNames, collapse = ", "), "\n")
  cat("Associated indices: ", paste(obj$info$output$indexModel, collapse = ", "), "\n")
  cat("jjm.data from ", sQuote(obj$info$data$file), "\n", sep = "")
  #cat("Projection years number: ", paste(length(obj$output$SSB_fut_1), collapse = ", "), "\n")
  cat(" ", "\n")
  
  }
  
  return(invisible())
  
}

summary.jjm.output = function(object, Projections = FALSE, Fmult = NULL,
                              BiomProj = NULL, 
                              CapProj = NULL, 
                              MRS = NULL, ...) {
  
  pic = list()
  namesPlot = NULL
  for(i in seq_along(object)){
    
    jjm.stocks = object[[i]]$output
    
    for(j in seq_along(jjm.stocks)){
      
      jjm.out = jjm.stocks[[j]]
      jjm.in  = object[[i]]$data
      jjm.ypr = jjm.stocks[[j]]$YPR
      namesPlot[j] = as.list(names(object[[i]]$output))[[j]]
      
      pic[[j]] = .fit_summarySheet3FUN(jjm.out, scales = list(alternating = 1, tck = c(1,0),
                                                              y = list(relation = "free", rot = 0),
                                                              axs = "i"), ...)
    }

  }
  
  names(pic) = namesPlot

  output = list()
  output$parameters = .ParTable(object)
  output$like = .LikeTable(object)
  output$projections = .ProjTable(object, Projections = Projections,
                                  Fmult = Fmult, BiomProj = BiomProj, 
                                  CapProj = CapProj, MRS = MRS)
  output$plots = pic
    
  class(output) = "summary.jjm.output"

  return(output)
  
}

print.summary.jjm.output = function(x, ...) {
  
  
  cat("\nParameter Table:\n\n")
  print(x$parameters, ...)
  
  cat("\nLikelihood Table:\n\n")
  print(x$like, ...)
  
  if(!is.null(x$projections)) cat("\nProjection Table (s):\n\n")
  
  for(i in seq_along(x$projections)){
    
    cat(names(x$projections)[i], "\n")
    print(x$projections[[i]], ...)
    cat(" ", "\n")
    
  }
  
  cat("\nSummary Plot (s):\n\n")
  
  for(i in seq_along(x$plots)){
    
    cat(names(x$plots)[i], "\n")
  
  }
  
  return(invisible(x))
}



plot.jjm.output = function(x, what = "biomass", stack = TRUE, endvalue = FALSE, total = FALSE,
                           cols = NULL, poslegend = "right", scen = 1, ...){
  
    switch(what, biomass     = .funPlotSeries(x, what, cols, stack, endvalue, poslegend, total, ...),
               recruitment   = .funPlotSeries(x, what, cols, stack, endvalue, poslegend, total, ...),
               ssb           = .funPlotSeries(x, what, cols, stack, endvalue, poslegend, total, ...),
               noFishTB      = .funPlotSeries(x, what, cols, stack, endvalue, poslegend, total, ...),
               ftot          = .funPlotSeries(x, what, cols, stack, endvalue, poslegend, total, ...),
               kobe          = .funPlotKobe(x, what, cols, stack, endvalue, poslegend, ...),
               catchProj     = .funPlotProj(x, what, cols, stack, endvalue, poslegend, ...),
               ssbProj       = .funPlotProj(x, what, cols, stack, endvalue, poslegend, ...),
			   totalProj     = .funPlotTotProj(x, what, cols, stack, endvalue, poslegend, scen, ...), #review
			   catchProjScen = .funPlotScen(x, what, cols, stack, endvalue, poslegend, ...),          
			   ssbProjScen   = .funPlotScen(x, what, cols, stack, endvalue, poslegend, ...),         
			   ratioSSB_F    = .funPlotRatioSSB_F(x, what, cols, stack, endvalue, poslegend, ...),
			   ratioSSB      = .funPlotRatioSSB(x, what, cols, stack, endvalue, poslegend, ...))
  
}

